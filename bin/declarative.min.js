/*

 declarative - Mapper for custom user interface markup - version 1.2.6

 Copyright 2012, Alex Lawrence
 Licensed under the MIT license.
 http://www.opensource.org/licenses/MIT

*/
(function(e,o){typeof exports==="object"?module.exports=o():typeof define==="function"&&define.amd?define(o):e.declarative=o()})(this,function(){function e(b,a,c){e[b]=o(c?a:[],c||a)}function o(b,a){for(var c=[],d;d=b.shift();)c.push(e[d]);return a.apply({},c)}e("common/errors",function(){return{parseOptions:"declarative: Error parsing options",verifyDomElement:"declarative: Invalid DOM element given",getSingleMapping:"declarative: Mapping id not existing",validateMapping:"declarative: Invalid mapping options",
validateMappingId:"declarative: Invalid mapping id",validateMappingTypes:"declarative: Missing mapping types",validateMappingTypesFormat:"declarative: Invalid mapping types",validateMappingCallback:"declarative: Invalid mapping callback",validateMappingMode:"declarative: Invalid mappingMode"}});e("common/mappingModes",function(){return{attribute:"attribute",element:"element"}});e("common/array",function(){var b={};b.ensureArray=function(a){return b.isArray(a)?a:[a]};b.isArray=function(a){return Object.prototype.toString.call(a)===
"[object Array]"};b.indexOf=function(a,b){for(var d=0,f=a.length;d<f;d++)if(a[d]==b)return d;return-1};return b});e("common/hyphenate",function(){var b=RegExp(/([A-Z])/g);return function(a){return a.replace(b,function(a,b){return"-"+b.toLowerCase()})}});e("common/parseOptions",["common/errors"],function(b){return function(a){try{return eval("output = {"+a+"}")}catch(c){throw Error(b.parseOptions);}}});e("dom/isDomElement",function(){return function(b){return b&&(b.nodeType===1||b.nodeType===9)}});
e("dom/generateCssSelectors",["common/mappingModes"],function(b){return function(a){var c;(c=a[b.attribute].join("],["))&&(c="["+c+"]");a=a[b.element].join(",");return c+(c&&a?",":"")+a}});e("dom/getRelevantElements",["common/mappingModes","dom/generateCssSelectors"],function(b,a){return function(c,d){var f;if(c.querySelectorAll){f={};f[b.attribute]=[];f[b.element]=[];for(var e=0,g=d.length;e<g;e++){var w=d[e],j=w.mappingMode;f[j]=f[j].concat(w.convertedTypes)}f=a(f);f=c.querySelectorAll(f)}else f=
c.all?c.all:c.getElementsByTagName("*");return f}});e("dom/getSpecifiedAttributes",["common/errors","dom/isDomElement"],function(b,a){return function(c){if(!a(c))throw Error(b.verifyDomElement);for(var c=c.attributes,d,e={},p=0,g=c.length;p<g;p++)if(d=c[p],d.specified)e[d.nodeName]=d.nodeValue;return e}});e("processing/validateMapping",["common/errors","common/mappingModes"],function(b,a){var c=function(a){throw Error(a);};return function(d){d||c(b.validateMapping);d.id||c(b.validateMappingId);d.types||
c(b.validateMappingTypes);d.types&&!d.types.push&&c(b.validateMappingTypesFormat);(!d.callback||typeof d.callback!=="function")&&c(b.validateMappingCallback);d.mappingMode&&d.mappingMode!==a.attribute&&d.mappingMode!==a.element&&c(b.validateMappingMode)}});e("processing/completeMapping",["common/mappingModes"],function(b){return function(a){a.prefix=a.prefix||"";a.mappingMode=a.mappingMode||b.attribute;a.distinct=a.distinct!==void 0?a.distinct:true}});e("processing/optimizeMapping",["common/hyphenate"],
function(b){return function(a){a.prefix=a.prefix.toLowerCase();a.convertedTypes=[];for(var c=0,d=a.types.length;c<d;c++){var e=b(a.types[c]);a.convertedTypes.push(a.prefix+e)}}});e("mappings",["common/errors","common/array","processing/validateMapping","processing/completeMapping","processing/optimizeMapping"],function(b,a,c,d,e){var p=function(){throw Error(b.getSingleMapping);},g={};return{clear:function(){g={}},add:function(b){for(var b=a.ensureArray(b),j=0,y=b.length;j<y;j++){var k=b[j];c(k);
d(k);e(k);g[k.id]=k}},getAll:function(){var a=[],b;for(b in g)g.hasOwnProperty(b)&&a.push(g[b]);return a},get:function(b){if(!a.isArray(b))return g[b]||p();for(var c=[],d=0,e=b.length;d<e;d++)c.push(g[b[d]]||p());return c}}});e("applyMappingsTo","common/array,common/errors,common/parseOptions,common/mappingModes,dom/isDomElement,dom/getRelevantElements,dom/getSpecifiedAttributes".split(","),function(b,a,c,d,e,p,g){var o=function(b,a,c){a.distinct&&(a=b.getAttribute(n),a||(a=k++,b.setAttribute(n,a)),
j[a]=j[a]||[],j[a].push(c))},j={},n="data-declarative-id",k=1;return function(k){return{to:function(i){if(!e(i))throw Error(a.verifyDomElement);for(var u=p(i,k),v=u.length,s=i!=document?i:u[--v],t=0,z=k.length,r=0,x=0;s;){for(t=0;t<z;t++){i=k[t];for(r=0,x=i.convertedTypes.length;r<x;r++){var l=i,h=i.convertedTypes[r],m=s.getAttribute(n);if(!l.distinct||!(m>0&&b.indexOf(j[m],h)>-1)){if(i.mappingMode===d.attribute){var l=s,h=i,m=r,q=l.getAttributeNode(h.convertedTypes[m]);q&&q.specified&&(q=c(q.nodeValue),
h.callback(l,h.types[m],q),o(l,h,h.types[m]))}i.mappingMode===d.element&&(l=s,h=i,m=r,l.nodeName.toLowerCase()==h.convertedTypes[m]&&(q=g(l),h.callback(l,h.types[m],q),o(l,h,h.types[m])))}}}s=v&&u[--v]}}}}});e("apply",["common/array","mappings","applyMappingsTo"],function(b,a,c){return function(d){d=a.get(d);d=b.ensureArray(d);return c(d)}});e("applyAllMappings",["mappings","applyMappingsTo"],function(b,a){return function(){return a(b.getAll())}});var n={};o(["common/mappingModes","mappings","apply",
"applyAllMappings"],function(b,a,c,d){n.mappingModes=b;n.mappings=a;n.apply=c;n.applyAllMappings=d});n.version="1.2.6";return n});
