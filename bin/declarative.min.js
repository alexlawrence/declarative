/*

 declarative - Mapper for custom user interface markup - version 1.3.7

 Copyright 2012, Alex Lawrence
 Licensed under the MIT license.
 http://www.opensource.org/licenses/MIT

*/
(function(d,i){typeof exports==="object"?module.exports=i():typeof define==="function"&&define.amd?define(i):d.declarative=i()})(this,function(){function d(b,a,c){d[b]=i(c?a:[],c||a)}function i(b,a,c,e){c=[];for(e in b)c[e]=d[b[e]];return a.apply(0,c)}d("settings",function(){return{mappingTimeoutMs:1E3,mappingWaitTimeMs:20}});d("errors",function(){return{parseOptions:"declarative: Error parsing options",verifyDomElement:"declarative: Invalid DOM element given",getSingleMapping:"declarative: Mapping id not existing",
validateMapping:"declarative: Invalid mapping options",validateMappingId:"declarative: Invalid mapping id",validateMappingTypes:"declarative: Missing mapping types",validateMappingTypesFormat:"declarative: Invalid mapping types",validateMappingCallback:"declarative: Invalid mapping callback",validateMappingMode:"declarative: Invalid mappingMode"}});d("mappingModes",function(){return{attribute:"attribute",element:"element"}});d("common/array",function(){var b={};b.ensureArray=function(a){return b.isArray(a)?
a:[a]};b.isArray=function(a){return Object.prototype.toString.call(a)==="[object Array]"};b.indexOf=function(a,c){for(var e=0,b=a.length;e<b;e++)if(a[e]==c)return e;return-1};return b});d("common/async",function(){return function(b){var a,c=function(){a=(new Date).getTime();b(e,j)},e=function(){return(new Date).getTime()-a},j=function(a){setTimeout(c,a)};c()}});d("common/Deferred",function(){var b=function(){if(!(this instanceof b))return new b;var e=null,j,g,d=[],k=[];this.then=function(a,r){var l=
new b,r=r||function(){},a=c(this,a||function(){},l);e=="resolved"&&a.apply(this,j);e=="rejected"&&r.apply(this,g);d.push(a);k.push(r);return l};this.resolve=function(){e||(j=arguments,a(this,d,j),e="resolved")};this.reject=function(){e||(g=arguments,a(this,k,g),e="rejected")}},a=function(a,c,b){for(var d=0,k=c.length;d<k;d++)c[d].apply(a,b)},c=function(a,c,b){return function(){try{b.resolve(c.apply(a,arguments))}catch(d){b.reject(d)}}};return b});d("common/hyphenate",function(){var b=RegExp(/([A-Z])/g);
return function(a){return a.replace(b,function(a,b){return"-"+b.toLowerCase()})}});d("common/parseOptions",["common/errors"],function(b){return function(a){try{return eval("output = {"+a+"}")}catch(c){throw Error(b.parseOptions);}}});d("dom/generateCssSelectors",["mappingModes"],function(b){return function(a){var c;(c=a[b.attribute].join("],["))&&(c="["+c+"]");a=a[b.element].join(",");return c+(c&&a?",":"")+a}});d("dom/getRelevantElements",["dom/generateCssSelectors","mappingModes"],function(b,a){return function(c,
e){var j;if(c.querySelectorAll){j={};j[a.attribute]=[];j[a.element]=[];for(var d=0,f=e.length;d<f;d++){var k=e[d],o=k.mappingMode;j[o]=j[o].concat(k.convertedTypes)}j=b(j);j=c.querySelectorAll(j)}else j=c.all?c.all:c.getElementsByTagName("*");return j}});d("dom/getSpecifiedAttributes",["errors","dom/isDomElement"],function(b,a){return function(c){if(!a(c))throw Error(b.verifyDomElement);for(var c=c.attributes,e,d={},g=0,f=c.length;g<f;g++)if(e=c[g],e.specified)d[e.nodeName]=e.nodeValue;return d}});
d("dom/isDomElement",function(){return function(b){return b&&(b.nodeType===1||b.nodeType===9)}});d("mapping/validateMapping",["mappingModes","errors"],function(b,a){var c=function(a){throw Error(a);};return function(e){e||c(a.validateMapping);e.id||c(a.validateMappingId);e.types||c(a.validateMappingTypes);e.types&&!e.types.push&&c(a.validateMappingTypesFormat);(!e.callback||typeof e.callback!=="function")&&c(a.validateMappingCallback);e.mappingMode&&e.mappingMode!==b.attribute&&e.mappingMode!==b.element&&
c(a.validateMappingMode)}});d("mapping/completeMapping",["mappingModes"],function(b){return function(a){a.prefix=a.prefix||"";a.mappingMode=a.mappingMode||b.attribute;a.distinct=a.distinct!==void 0?a.distinct:true}});d("mapping/optimizeMapping",["common/hyphenate"],function(b){return function(a){a.prefix=a.prefix.toLowerCase();a.convertedTypes=[];for(var c=0,e=a.types.length;c<e;c++){var d=b(a.types[c]);a.convertedTypes.push(a.prefix+d)}}});d("mapping/mappings",["common/array","errors","mapping/validateMapping",
"mapping/completeMapping","mapping/optimizeMapping"],function(b,a,c,e,d){var g=function(){throw Error(a.getSingleMapping);},f={};return{clear:function(){f={}},add:function(a){for(var a=b.ensureArray(a),o=0,g=a.length;o<g;o++){var l=a[o];c(l);e(l);d(l);f[l.id]=l}},getAll:function(){var a=[],b;for(b in f)f.hasOwnProperty(b)&&a.push(f[b]);return a},get:function(a){if(!b.isArray(a))return f[a]||g();for(var c=[],e=0,d=a.length;e<d;e++)c.push(f[a[e]]||g());return c}}});d("mapping/apply","mappingModes,errors,settings,common/array,common/parseOptions,common/async,common/Deferred,dom/isDomElement,dom/getSpecifiedAttributes,dom/getRelevantElements,mapping/mappings".split(","),
function(b,a,c,e,d,g,f,k,o,n,l){var i=function(a){return{to:function(b){return v(a,b)}}},v=function(u,h){if(!k(h))throw Error(a.verifyDomElement);var l=n(h,u),i,w=l.length,q=h!=document?h:l[--w],s=0,v=u.length,p=0,y=0,z=new f;g(function(a,g){for(;q;){for(s=0;s<v;s++){i=u[s];for(p=0,y=i.convertedTypes.length;p<y;p++){var f=i,h=i.convertedTypes[p],m=q.getAttribute(x);if(!f.distinct||!(m>0&&e.indexOf(t[m],h)>-1)){if(i.mappingMode===b.attribute){var f=q,h=i,m=p,k=f.getAttributeNode(h.convertedTypes[m]);
k&&k.specified&&(k=d(k.nodeValue),h.callback(f,h.types[m],k),A(f,h,h.convertedTypes[m]))}i.mappingMode===b.element&&(f=q,h=i,m=p,f.nodeName.toLowerCase()==h.convertedTypes[m]&&(k=o(f),h.callback(f,h.types[m],k),A(f,h,h.convertedTypes[m])))}}}q=w&&l[--w];if(a()>c.mappingTimeoutMs){g(c.mappingWaitTimeMs);return}}z.resolve()});return z},A=function(a,b,c){b.distinct&&(b=a.getAttribute(x),b||(b=B++,a.setAttribute(x,b)),t[b]=t[b]||[],t[b].push(c))},t={},x="data-declarative-id",B=1;return function(a){a=
l.get(a);a=e.ensureArray(a);return i(a)}});d("mapping/applyAllMappings",["mapping/mappings","mapping/apply"],function(b,a){return function(){for(var c=[],e=b.getAll(),d=0,g=e.length;d<g;d++)c.push(e[d].id);return a(c)}});var n={};i(["mappingModes","mapping/mappings","mapping/apply","mapping/applyAllMappings","settings"],function(b,a,c,e,d){n.mappingModes=b;n.mappings=a;n.apply=c;n.applyAllMappings=e;n.settings=d});n.version="1.3.7";return n});
