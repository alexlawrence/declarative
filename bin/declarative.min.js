/*

 declarative - Mapper for custom user interface markup - version 1.1.0

 Copyright 2012, Alex Lawrence
 Licensed under the MIT license.
 http://www.opensource.org/licenses/MIT

*/
(function(f,d){typeof exports==="object"?module.exports=d():typeof define==="function"&&define.amd?define(d):f.declarative=d()})(this,function(){var f={},d={};(function(){var e=d.array={};e.ensureArray=function(b){return e.isArray(b)?b:[b]};e.isArray=function(b){return Object.prototype.toString.call(b)==="[object Array]"};e.indexOf=function(b,c){for(var a=0,d=b.length;a<d;a++)if(b[a]==c)return a;return-1}})();(function(){d.hyphenate=function(b){return b.replace(e,function(b,a){return"-"+a.toLowerCase()})};
var e=RegExp(/([A-Z])/g)})();(function(){d.isDOMElement=function(c){return c&&(c.nodeType===e||c.nodeType===b)};var e=1,b=9})();d.mappingModes={attribute:"attribute",element:"element"};(function(){var e=d.mappingModes,b=d.mappingUtilities={};b.validateMapping=function(a){a||c("invalid options");a.id||c("missing id");a.types||c("missing types");a.types&&!a.types.push&&c("invalid types");(!a.callback||typeof a.callback!=="function")&&c("invalid callback");a.mappingMode&&a.mappingMode!==e.attribute&&
a.mappingMode!==e.element&&c("invalid mappingMode")};b.completeMapping=function(a){a.prefix=a.prefix||"";a.mappingMode=a.mappingMode||e.attribute};b.optimizeMapping=function(a){a.prefix=a.prefix.toLowerCase();a.convertedTypes=[];for(var b=0,c=a.types.length;b<c;b++){var e=d.hyphenate(a.types[b]);a.convertedTypes.push(a.prefix+e)}};var c=function(a){throw Error("internal.mappingUtilities.validateMapping: "+a);}})();(function(){var e=d.mappingModes;d.generateCssSelectors=function(b){var c;(c=b[e.attribute].join("],["))&&
(c="["+c+"]");b=b[e.element].join(",");return c+(c&&b?",":"")+b}})();(function(){var e=d.mappingModes;d.getRelevantElements=function(b,c){var a;if(c.querySelectorAll){a={};a[e.attribute]=[];a[e.element]=[];for(var g=0,n=b.length;g<n;g++){var o=b[g],f=o.mappingMode;a[f]=a[f].concat(o.convertedTypes)}a=d.generateCssSelectors(a);a=c.querySelectorAll(a)}else a=c.all?c.all:c.getElementsByTagName("*");return a}})();(function(){var e=d.isDOMElement;d.getSpecifiedAttributes=function(b){if(!e(b))throw Error("declarative.getSpecifiedAttributes: invalid element (DOM element required)");
for(var b=b.attributes,c,a={},d=0,n=b.length;d<n;d++)if(c=b[d],c.specified)a[c.nodeName]=c.nodeValue;return a}})();(function(){d.parseOptions=function(b){try{return e(b)}catch(c){throw Error("declarative.parseOptions: Parsing error");}};var e=function(b){return eval("output = {"+b+"}")}})();(function(){var e=d.array.isArray,b=d.array.ensureArray,c=d.mappingUtilities;f.mappings={};f.mappings.clear=function(){g={}};f.mappings.add=function(a){for(var a=b(a),d=0,e=a.length;d<e;d++){var f=a[d];c.validateMapping(f);
c.completeMapping(f);c.optimizeMapping(f);g[f.id]=f}};f.mappings.getAll=function(){var a=[],b;for(b in g)g.hasOwnProperty(b)&&a.push(g[b]);return a};f.mappings.get=function(b){if(!e(b))return a(b);for(var c=[],d=0,f=b.length;d<f;d++)c.push(a(b[d]));return c};var a=function(a){var b;if(!(b=g[a]))throw Error("declarative.mappings.get: "+('invalid id "'+a+'"'));return b},g={}})();(function(){var e=d.array.ensureArray,b=d.mappingModes;f.apply=function(a){a=f.mappings.get(a);a=e(a);return c(a)};f.applyAllMappings=
function(){var a=f.mappings.getAll();return c(a)};var c=function(a){return{to:function(c){if(!d.isDOMElement(c))throw Error("declarative.apply.to: invalid element (DOM object required)");for(var e=d.getRelevantElements(a,c),f,p=e.length,m=0,r=a.length,k=0,q=0;c;){for(m=0;m<r;m++){f=a[m];for(k=0,q=f.convertedTypes.length;k<q;k++){if(f.mappingMode===b.attribute){var h=c,i=f,l=k,j=h.getAttributeNode&&h.getAttributeNode(i.convertedTypes[l]);j&&j.specified&&(j=d.parseOptions(j.nodeValue),i.callback(h,
i.types[l],j))}f.mappingMode===b.element&&(h=c,i=f,l=k,h.nodeName.toLowerCase()==i.convertedTypes[l]&&(j=d.getSpecifiedAttributes(h),i.callback(h,i.types[l],j)))}}c=p&&e[--p]}}}}})();f.version="1.1.0";return f});
