/**
 * @license
 * declarative - Mapper for custom user interface markup - version 1.3.7
 * Copyright 2012, Alex Lawrence
 * Licensed under the MIT license.
 * http://www.opensource.org/licenses/MIT
 */
(function(a,b){typeof exports=="object"?module.exports=b():typeof define=="function"&&define.amd?define(b):a.declarative=b()})(this,function(){function define(a,b,c){define[a]=require(c?b:[],c||b)}function require(a,b,c,d){c=[];for(d in a)c[d]=define[a[d]];return b.apply(0,c)}define("settings",function(){return{mappingTimeoutMs:1e3,mappingWaitTimeMs:20}}),define("errors",function(){var a={};return a.parseOptions="declarative: Error parsing options",a.verifyDomElement="declarative: Invalid DOM element given",a.getSingleMapping="declarative: Mapping id not existing",a.validateMapping="declarative: Invalid mapping options",a.validateMappingId="declarative: Invalid mapping id",a.validateMappingTypes="declarative: Missing mapping types",a.validateMappingTypesFormat="declarative: Invalid mapping types",a.validateMappingCallback="declarative: Invalid mapping callback",a.validateMappingMode="declarative: Invalid mappingMode",a}),define("mappingModes",function(){var a={attribute:"attribute",element:"element"};return a}),define("common/array",function(){var a={};return a.ensureArray=function(b){return a.isArray(b)?b:[b]},a.isArray=function(a){return Object.prototype.toString.call(a)==="[object Array]"},a.indexOf=function(a,b){for(var c=0,d=a.length;c<d;c++)if(a[c]==b)return c;return-1},a}),define("common/async",function(){var a=function(a){var b,c=function(){b=(new Date).getTime(),a(d,e)},d=function(){return(new Date).getTime()-b},e=function(a){setTimeout(c,a)};c()};return a}),define("common/Deferred",function(){var a=function(){if(!(this instanceof a))return new a;var d=null,e="resolved",f="rejected",g,h,i=[],j=[];this.then=function(b,k){var l=new a;return k=k||function(){},b=b||function(){},b=c(this,b,l),d==e&&b.apply(this,g),d==f&&k.apply(this,h),i.push(b),j.push(k),l},this.resolve=function(){d||(g=arguments,b(this,i,g),d=e)},this.reject=function(){d||(h=arguments,b(this,j,h),d=f)}},b=function(a,b,c){for(var d=0,e=b.length;d<e;d++)b[d].apply(a,c)},c=function(a,b,c){return function(){try{c.resolve(b.apply(a,arguments))}catch(d){c.reject(d)}}};return a}),define("common/hyphenate",function(){var a=new RegExp(/([A-Z])/g),b=function(b){return b.replace(a,function(a,b){return"-"+b.toLowerCase()})};return b}),define("common/parseOptions",["errors"],function(errors){var parseOptions=function(input){try{var output;return eval("output = {"+input+"}")}catch(error){throw new Error(errors.parseOptions)}};return parseOptions}),define("dom/generateCssSelectors",["mappingModes"],function(a){var b=function(b){var f=c(b[a.attribute]),g=d(b[a.element]);return e(f,g)},c=function(a){var b=a.join("],[");return b&&(b="["+b+"]"),b},d=function(a){return a.join(",")},e=function(a,b){return a+(a&&b?",":"")+b};return b}),define("dom/getRelevantElements",["dom/generateCssSelectors","mappingModes"],function(a,b){var c=function(a,b){return a.querySelectorAll?d(a,b):a.all?a.all:a.getElementsByTagName("*")},d=function(c,d){var e={};e[b.attribute]=[],e[b.element]=[];for(var f=0,g=d.length;f<g;f++){var h=d[f],i=h.mappingMode;e[i]=e[i].concat(h.convertedTypes)}var j=a(e);return c.querySelectorAll(j)};return c}),define("dom/getSpecifiedAttributes",["errors","dom/isDomElement"],function(a,b){var c=function(a){d(a);var b=a.attributes,c,e={};for(var f=0,g=b.length;f<g;f++)c=b[f],c.specified&&(e[c.nodeName]=c.nodeValue);return e},d=function(c){if(!b(c))throw new Error(a.verifyDomElement)};return c}),define("dom/isDomElement",function(){var a=function(a){return a&&(a.nodeType===b||a.nodeType===c)},b=1,c=9;return a}),define("mapping/validateMapping",["mappingModes","errors"],function(a,b){var c=function(c){c||d(b.validateMapping),c.id||d(b.validateMappingId),c.types||d(b.validateMappingTypes),c.types&&!c.types.push&&d(b.validateMappingTypesFormat),(!c.callback||typeof c.callback!="function")&&d(b.validateMappingCallback),c.mappingMode&&c.mappingMode!==a.attribute&&c.mappingMode!==a.element&&d(b.validateMappingMode)},d=function(a){throw new Error(a)};return c}),define("mapping/completeMapping",["mappingModes"],function(a){var b=function(b){b.prefix=b.prefix||"",b.mappingMode=b.mappingMode||a.attribute,b.distinct=b.distinct!==undefined?b.distinct:!0};return b}),define("mapping/optimizeMapping",["common/hyphenate"],function(a){var b=function(b){b.prefix=b.prefix.toLowerCase(),b.convertedTypes=[];for(var c=0,d=b.types.length;c<d;c++){var e=a(b.types[c]);b.convertedTypes.push(b.prefix+e)}};return b}),define("mapping/mappings",["common/array","errors","mapping/validateMapping","mapping/completeMapping","mapping/optimizeMapping"],function(a,b,c,d,e){var f={};f.clear=function(){i={}},f.add=function(b){b=a.ensureArray(b);for(var f=0,g=b.length;f<g;f++){var h=b[f];c(h),d(h),e(h),i[h.id]=h}},f.getAll=function(){var a=[];for(var b in i)i.hasOwnProperty(b)&&a.push(i[b]);return a},f.get=function(b){if(!a.isArray(b))return g(b);var c=[];for(var d=0,e=b.length;d<e;d++)c.push(g(b[d]));return c};var g=function(a){return i[a]||h()},h=function(){throw new Error(b.getSingleMapping)},i={};return f}),define("mapping/apply",["mappingModes","errors","settings","common/array","common/parseOptions","common/async","common/Deferred","dom/isDomElement","dom/getSpecifiedAttributes","dom/getRelevantElements","mapping/mappings"],function(a,b,c,d,e,f,g,h,i,j,k){var l=function(a){var b=k.get(a);return b=d.ensureArray(b),m(b)},m=function(a){return{to:function(b){return n(a,b)}}},n=function(b,d){o(d);var e=j(d,b),h,i,k=e.length,l=d!=document?d:e[--k],m=0,n=b.length,s=0,t=0,u=new g;return f(function(d,f){while(l){i=l.attributes;for(m=0;m<n;m++){h=b[m];for(s=0,t=h.convertedTypes.length;s<t;s++){if(p(h,l,h.convertedTypes[s]))continue;h.mappingMode===a.attribute&&q(l,h,s),h.mappingMode===a.element&&r(l,h,s)}}l=k&&e[--k];if(d()>c.mappingTimeoutMs){f(c.mappingWaitTimeMs);return}}u.resolve()}),u},o=function(a){if(!h(a))throw new Error(b.verifyDomElement)},p=function(a,b,c){var e=b.getAttribute(u);return a.distinct&&e>0&&d.indexOf(t[e],c)>-1},q=function(a,b,c){var d=a.getAttributeNode(b.convertedTypes[c]);if(d&&d.specified){var f=e(d.nodeValue);b.callback(a,b.types[c],f),s(a,b,b.convertedTypes[c])}},r=function(a,b,c){if(a.nodeName.toLowerCase()==b.convertedTypes[c]){var d=i(a);b.callback(a,b.types[c],d),s(a,b,b.convertedTypes[c])}},s=function(a,b,c){if(b.distinct){var d=a.getAttribute(u);d||(d=v++,a.setAttribute(u,d)),t[d]=t[d]||[],t[d].push(c)}},t={},u="data-declarative-id",v=1;return l}),define("mapping/applyAllMappings",["mapping/mappings","mapping/apply"],function(a,b){return function(){var c=[],d=a.getAll();for(var e=0,f=d.length;e<f;e++)c.push(d[e].id);return b(c)}});var declarative={};return require(["mappingModes","mapping/mappings","mapping/apply","mapping/applyAllMappings","settings"],function(a,b,c,d,e){declarative.mappingModes=a,declarative.mappings=b,declarative.apply=c,declarative.applyAllMappings=d,declarative.settings=e}),declarative.version="1.3.7",declarative});